{% block modal %}
<!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel"><i class=" fa-solid fa-pen-to-square"></i> Édition de l'équipement</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="/save/modal/equipement" method="post" class="row g-12">
                        <input type="hidden" class="form-control" id="modal_libelle" value="" name="libelle" />
                        <input type="hidden" class="form-control" id="modal_idContact" value="" name="idContact" />
                        <input type="hidden" class="form-control" id="modal_idSociete" value="" name="idSociete" />
                        <input type="hidden" class="form-control" id="modal_anomalies" value="" name="anomalies" />
                        <input type="hidden" class="form-control" id="modal_trigrammeTech" value="" name="trigrammeTech" />
                        <input type="hidden" class="form-control" id="modal_signatureTech" value="" name="signatureTech" />
                        <input type="hidden" class="form-control" id="modal_ifExistDB" value="" name="ifExistDB" />
                        <input type="hidden" class="form-control" id="modal_hauteurNacelle" value="" name="hauteurNacelle" />
                        <input type="hidden" class="form-control" id="modal_modeleNacelle" value="" name="modeleNacelle" />
                        <input type="hidden" class="form-control" id="modal_raisonSociale" value="" name="raisonSociale" />
                        <input type="hidden" class="form-control" id="modal_visite" value="" name="visite" />
                        <input type="hidden" class="form-control" id="modal_id" value="" name="id" />
                        <div class="col-md-12">
                            <h3>Personne modifiant l'équipement</h3>
                            <div class="col-md-6">
                                <label for="nom" class="form-label">Votre nom</label>
                                <input type="text" class="form-control" id="modal_nom" value="" name="nom" />
                            </div>
                            <div class="col-md-6">
                                <label for="prenom" class="form-label">Votre prénom</label>
                                <input type="text" class="form-control" id="modal_prenom" value="" name="prenom" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="trigramme" class="form-label">Équipement cible</label>
                            <input type="text" class="form-control" placeholder="" id="modal_trigramme" value="" name="trigramme" />
                            <label for="codeAgence" class="form-label">Code Agence</label>
                            <input type="text" class="form-control" placeholder="" id="modal_codeAgence" value="" name="codeAgence" />
                        </div>
                        <div class="col-md-6">
                            <label for="modeFonctionnement" class="form-label">Mode de fonctionnement</label>
                            <input type="text" class="form-control" placeholder="" id="modal_modeFonctionnement" value="" name="modefonctionnement" />
                        </div>
                        <div class="col-md-6">
                            <label for="repereCiteClient" class="form-label">Repère site client</label>
                            <input type="text" id="modal_repereSiteClient" class="form-control" placeholder="" value="" name="reperesiteclient" />
                        </div>
                        <div class="col-md-6">
                            <label for="miseEnService" class="form-label">Mise en service</label>
                            <input type="text" id="modal_miseEnService" class="form-control" placeholder="" value="" name="miseenservice" />
                        </div>
                        <div class="col-md-6">
                            <label for="numeroDeSerie" class="form-label">Numéro de série</label>
                            <input type="text" id="modal_numeroDeSerie" class="form-control" placeholder="" value="" name="numerodeserie" />
                        </div>
                        <div class="col-md-6">
                            <label for="marque" class="form-label">Marque</label>
                            <input type="text" id="modal_marque" class="form-control" placeholder="" value="" name="marque" />
                        </div>
                        <div class="col-md-6">
                            <label for="hauteur" class="form-label">Hauteur</label>
                            <input type="text" id="modal_hauteur" class="form-control" placeholder="" value="" name="hauteur" />
                        </div>
                        <div class="col-md-6">
                            <label for="Largeur" class="form-label">Largeur</label>
                            <input type="text" id="modal_largeur" class="form-control" placeholder="" value="" name="largeur" />
                        </div>
                        <div class="col-md-6">
                            <label for="longueur" class="form-label">Longueur</label>
                            <input type="text" id="modal_longueur" class="form-control" placeholder="" value="" name="longueur" />
                        </div>
                        <div class="col-md-12">
                            <label for="plaqueSignaletique" class="form-label">Plaque signalétique</label>
                            <input type="text" id="modal_plaqueSignaletique" class="form-control" placeholder="" value="" name="plaquesignaletique"/>
                        </div>
                        <div class="col-12">
                            <label for="etat" class="form-label">État de l'équipement</label>
                            <textarea id="modal_etat" class="form-control " value="" name="etat" ></textarea>
                        </div>
                        <div class="col-6">
                            <label for="dateDerniereVisite" class="form-label">Dernière visite de maintenance</label>
                            <input type="text" id="modal_derniereVisite"class="form-control" placeholder="" value="" name="dernierevisitedemaintenance" />
                        </div>
                        <div class="col-6">
                            <label for="statut-actuel" class="form-label">Statut actuel de l'équipement</label>
                            <input type="text" id="modal_statut" class="form-control" placeholder="" value="" name="oldstatut" />
                        </div>
                        <div class="col-6">
                            <label for="statut" class="form-label">Statut de l'équipement</label>
                            <select id="modal_prochain_statut" class="form-select"  name="newstatutclient">
                                <option selected>Choose...</option>
                                <option value="Vert">Vert</option>
                                <option value="Orange">Orange</option>
                                <option value="Rouge">Rouge</option>
                                <option value="A l'arrêt">A l'arrêt</option>
                                <option value="Innaccessible">Inaccessible</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="carnetEntretien" class="form-label">Présence carnet d'entretien</label>
                            <input type="text" id="modal_carnetEntretien" class="form-control" placeholder="" value="" name="carnetentretien" />
                        </div>
                        <div class="col-md-6">
                            <label for="statutConformite" class="form-label">Statut conformité</label>
                            <input type="text" id="modal_statutConformite" class="form-control" placeholder="" value="" name="statutconformite" />
                        </div>
                        
                        <button type="submit" id="saveEquipmentFromModal" class="btn btn-primary" name="saveEquipmentFromModal">Enregistrer</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" >Close</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% if equipments|length > 0 %}
    <div class="equipment-list">
        <div class="equipment-item">
                <table id="table" class="table-equipement-client  table-bordered" data-toggle="table" data-pagination="true" data-search="true" data-filter-control="true" data-show-search-clear-button="true">
                    <thead>
                        <tr class="sticky">
                            <th data-sortable="true" data-filter-control="select" data-field="visite">Visite</th>
                            <th data-sortable="true" data-filter-control="select" data-field="n°">N°</th>
                            <th data-sortable="true" data-field="libelle">Libelle</th>
                            <th data-sortable="true" data-field="derniere_visite">Date visite</th>
                            <th data-sortable="false" data-field="repere">Repère</th>
                            <th data-sortable="false" data-field="installe_le">Installé le</th>
                            <th data-sortable="false" data-field="num_serie">N° de série</th>
                            <th data-sortable="true" data-filter-control="select" data-field="marque">Marque</th>
                            <th data-sortable="true" data-field="hauteur">h</th>
                            <th data-sortable="true" data-field="largeur">l</th>
                            <th data-sortable="true" data-field="longueur">L</th>
                            <th data-sortable="true" data-field="date_enregistrement">Enregistré / modifié</th>
                            <th data-sortable="true" data-filter-control="select" data-field="etat">État</th>
                            <th data-sortable="true" data-filter-control="select" data-field="statut_maintenance">Statut</th>
                            <th>Options</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for equipment in equipments %}
                        <tr class="bkg_row_visite_1" id="{{ equipment.getId() }}" data-visite="{{ equipment.getVisite() }}" data-libelle="{{ equipment.getLibelleEquipement() }}" data-statut="{{ equipment.getStatutDeMaintenance() }}">
                            <td>{{ equipment.getVisite() }}</td>
                            <td>{{ equipment.getNumeroEquipement() }}</td>
                            <td>{{ equipment.getLibelleEquipement() }}</td>
                            <td>{{ equipment.getDerniereVisite() }}</td>
                            <td>{{ equipment.getRepereSiteClient() }}</td>
                            <td>{{ equipment.getMiseEnService() }}</td>
                            <td>{{ equipment.getNumeroDeSerie() }}</td>
                            <td>{{ equipment.getMarque() }}</td>
                            <td>{{ equipment.getHauteur() }}</td>
                            <td>{{ equipment.getLargeur() }}</td>
                            <td>{{ equipment.getLongueur() }}</td>
                            <td>{{ equipment.getDateEnregistrement() }}</td>
                            {%if equipment.etat == "A" %}
                                <td>Bon état de fonctionnement le jour de la visite</td>
                                <td><figure><img src=" {{ asset('https://www.backend-kizeo.somafi-group.fr/public/img/logos/vert.png') }} " alt="etat-equipement" /><figcaption>Vert</figcaption></figure></td>
                                {% elseif equipment.etat == "B" %}
                                    <td>Travaux préventifs</td>
                                    <td><figure><img src=" {{ asset('https://www.backend-kizeo.somafi-group.fr/public/img/logos/orange.png') }} " alt="etat-equipement" /><figcaption>Orange</figcaption></figure></td>
                                {% elseif equipment.etat == "C" %}
                                    <td>Travaux curatifs</td>
                                    <td><figure><img src=" {{ asset('https://www.backend-kizeo.somafi-group.fr/public/img/logos/rouge.png') }} " alt="etat-equipement" /><figcaption>Rouge</figcaption></figure></td>
                                {% elseif equipment.etat == "D" %}
                                    <td>Equipement inaccessible le jour de la visite</td>
                                    <td><figure><img src=" {{ asset('https://www.backend-kizeo.somafi-group.fr/public/img/logos/noir.png') }} " alt="etat-equipement" /><figcaption>Noir</figcaption></figure></td>
                                {% elseif equipment.etat == "E" %}
                                    <td>Equipement à l'arrêt le jour de la visite</td>
                                    <td><figure><img src=" {{ asset('https://www.backend-kizeo.somafi-group.fr/public/img/logos/rouge.png') }} " alt="etat-equipement" /><figcaption>Rouge</figcaption></figure></td>
                                {% elseif equipment.etat == "F" %}
                                    <td>Equipement mis à l'arrêt lors de l'intervention</td>
                                    <td><figure><img src=" {{ asset('https://www.backend-kizeo.somafi-group.fr/public/img/logos/rouge.png') }} " alt="etat-equipement" /><figcaption>Rouge</figcaption></figure></td>
                                {% elseif equipment.etat == "G" %}
                                    <td>Equipement non présent sur site</td>
                                    <td>Equipement non présent sur site</td>
                                {% else %}
                                    <td>{{ equipment.getEtat() }}</td>
                            {% endif %}
                            {%if equipment.statutDeMaintenance == "Vert" %}
                                <td><figure><img src=" {{ asset('https://www.backend-kizeo.somafi-group.fr/public/img/logos/vert.png') }} " alt="etat-equipement" /><figcaption>{{ equipment.getStatutDeMaintenance() }}</figcaption></figure></td>
                                {% elseif equipment.statutDeMaintenance == "Orange" %}
                                <td><figure><img src=" {{ asset('https://www.backend-kizeo.somafi-group.fr/public/img/logos/orange.png') }} " alt="etat-equipement" /><figcaption>{{ equipment.getStatutDeMaintenance() }}</figcaption></figure></td>
                                {% elseif equipment.statutDeMaintenance == "Rouge" %}
                                <td><figure><img src=" {{ asset('https://www.backend-kizeo.somafi-group.fr/public/img/logos/rouge.png') }} " alt="etat-equipement" /><figcaption>{{ equipment.getStatutDeMaintenance() }}</figcaption></figure></td>
                                {% elseif equipment.statutDeMaintenance == "A l'arrêt" %}
                                <td><figure><img src=" {{ asset('https://www.backend-kizeo.somafi-group.fr/public/img/logos/rouge.png') }} " alt="etat-equipement" /><figcaption>{{ equipment.getStatutDeMaintenance() }}</figcaption></figure></td>
                                {% elseif equipment.statutDeMaintenance == "Inaccessible" %}
                                <td><figure><img src=" {{ asset('https://www.backend-kizeo.somafi-group.fr/public/img/logos/noir.png') }} " alt="etat-equipement" /><figcaption>{{ equipment.getStatutDeMaintenance() }}</figcaption></figure></td>
                                
                                {% elseif equipment.statutDeMaintenance == "Non présent" %}
                                <td>{{ equipment.getStatutDeMaintenance() }}</td>
                            {% endif %}
                            <td>
                            {% if is_granted('ROLE_ADMIN') %}
                                <button onclick="editEquipement(
                                    '{{ equipment.getId() }}',
                                    '{{ equipment.getLibelleEquipement() }}',
                                    '{{ equipment.getVisite() }}',
                                    '{{ equipment.getRaisonSociale() }}',
                                    '{{ equipment.getModeleNacelle() }}',
                                    '{{ equipment.getHauteurNacelle() }}',
                                    '{{ equipment.getIfExistDB() }}',
                                    '{{ equipment.getSignatureTech() }}',
                                    '{{ equipment.getTrigrammeTech() }}',
                                    '{{ equipment.getAnomalies() }}',
                                    '{{ equipment.getIdContact() }}',
                                    '{{ equipment.getCodeSociete() }}',
                                    '{{ equipment.getCodeAgence() }}',
                                    '{{ equipment.getNumeroEquipement() }}',
                                    '{{ equipment.getModeFonctionnement() }}',
                                    '{{ equipment.getRepereSiteClient() }}',
                                    '{{ equipment.getMiseEnService() }}',
                                    '{{ equipment.getNumeroDeSerie() }}',
                                    '{{ equipment.getMarque() }}',
                                    '{{ equipment.getHauteur() }}',
                                    '{{ equipment.getLargeur() }}',
                                    '{{ equipment.getLongueur() }}',
                                    '{{ equipment.getPlaqueSignaletique() }}',
                                    '{{ equipment.getEtat() }}',
                                    '{{ equipment.getDerniereVisite() }}',
                                    '{{ equipment.getStatutDeMaintenance() }}',
                                    '{{ equipment.getPresenceCarnetEntretien() }}',
                                    '{{ equipment.getStatutConformite() }}'
                                )" type="button" class="btn btn-primary edit_equipement" data-bs-toggle="modal" data-bs-target="#staticBackdrop" ><i class=" fa-solid fa-pen-to-square"></i> Edit
                                </button>
                            {% endif %}
                            <a style="margin-top:10px;" class="btn btn-primary" href="{{ path('app_show_equipement_details_by_id', {'agence': equipment.getCodeAgence(), 'id': equipment.getId() }) }}" target="_blank"><i class=" fa-solid fa-magnifying-glass-plus"></i> Fiche équipement</a>
                            </td>
                        </tr>                        
                        {% endfor %}
                    </tbody>
                </table>
            <script>
                $(function() {
                    $('#table').bootstrapTable()
                })
            </script>
        </div>
    </div>
{% else %}
    <p>Aucun équipement trouvé avec ces critères.</p>
{% endif %}